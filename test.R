# miles to km is miles * 1.609344
library(lubridate)
library(data.table)
library(dplyr)

library(leaflet)
library(scales)
library(data.table)  
library(dplyr)
library(rgdal)
x <- '01/01 00'
x <- format(strptime(x, '%M/%d %H'), '%M/%d %I %p')
library(data.table)  
files <- list.files(path = "./data",pattern = ".csv")
for(i in 1:length(files)){
  files[i] = paste('./data',files[i],sep='/')
}
temp <- lapply(files, fread, sep=",")
data <- rbindlist( temp )
rm(temp)
gc()
df <- group_by(data,`Trip Start Timestamp`) %>% summarise(rides = length(`Trip Seconds`))
colnames(df) = c("date","rides")
df$date = substr(df$date,5,6)
df <- group_by(df,date) %>% summarise(rides = sum(rides))
colnames(df) = c("date","rides")
df$date <-c('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec')
df$date <- factor(df$date,levels = c('Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'))
saveRDS(df,'./data/all_rides_monthly.rds')

df <- data.frame(data$`Trip Seconds`)
colnames(df) = c("seconds")
df <- df %>% mutate(bin = cut(seconds, breaks=c(59,180,360,600,900,1800,3600,5400,7200,10800,18000)))
df<- group_by(df,bin) %>% summarise(rides = length(seconds))
colnames(df) = c("seconds","rides")
df$seconds <- c('(59,180]','(180,360]','(360,600]','(600,900]','(900,1800]','(1800,3600]','(3600,5400]','(5400,7200]','(7200,10800]','(10800,18000]')
df$seconds <- factor(df$seconds,levels =  c('(59,180]','(180,360]','(360,600]','(600,900]','(900,1800]','(1800,3600]','(3600,5400]','(5400,7200]','(7200,10800]','(10800,18000]'))
saveRDS(df,'./data/all_trip_time.rds')

df <- group_by(data,`Trip Start Timestamp`) %>% summarise(rides = length(`Trip Seconds`))
colnames(df) = c("date","rides")
df$date = ymd(df$date)
saveRDS(df,'./data/all_rides_year_day.rds')